---
buildpack: python_buildpack
memory: 1G
services:
  - gds-performance-platform-pg-service
  - redis-poc
env:
  DJANGO_SETTINGS_MODULE: stagecraft.settings.production
  DEBUG: 1
  ENV_HOSTNAME: performance-platform-stagecraft.cloudapps.digital
  PUBLIC_HOSTNAME: performance-platform-stagecraft.cloudapps.digital
  STATIC_URL: /assets/

applications:
  - name: performance-platform-stagecraft-web
    command: python manage.py migrate && gunicorn stagecraft.wsgi:application --bind 0.0.0.0:$PORT --workers 4
    instances: 2
    memory: 512M
    no-route: true
    health-check-type: none

  - name: performance-platform-stagecraft-celery-worker
    command: python manage.py celeryd --settings=stagecraft.settings.production -E -l debug
    instances: 1
    memory: 256M
    no-route: true
    health-check-type: none

  - name: performance-platform-stagecraft-celery-beat
    command: python manage.py celerybeat --settings=stagecraft.settings.production -l debug
    instances: 1
    no-route: true
    memory: 128M
    health-check-type: none

  - name: performance-platform-stagecraft-celery-cam
    command: python manage.py celerycam --settings=stagecraft.settings.production
    instances: 1
    no-route: true
    memory: 128M
    health-check-type: none
